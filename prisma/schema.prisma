generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  ABM
  ASE
  ZBM
  ZSE
  SEC
  SAMSUNG_ADMINISTRATOR
  ZOPPER_ADMINISTRATOR
}

enum Validation {
  APPROVED
  PENDING
  BLOCKED
}

enum PlanType {
  SCREEN_PROTECT_1_YR
  ADLD_1_YR
  COMBO_2_YRS
  EXTENDED_WARRANTY_1_YR
  TEST_PLAN
}

model Store {
  id    String @id @map("_id")
  name  String
  city  String?
  state String?

  salesReports SpotIncentiveSalesReport[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SamsungSKU {
  id           String                     @id @default(auto()) @map("_id") @db.ObjectId
  Category     String
  ModelName    String
  plans        Plan[]
  salesReports SpotIncentiveSalesReport[]

  @@map("SamsungSKU")
}

model Plan {
  id           String                     @id @default(auto()) @map("_id") @db.ObjectId
  planType     PlanType
  price        Int
  samsungSKU   SamsungSKU?                @relation(fields: [samsungSKUId], references: [id])
  samsungSKUId String?                    @db.ObjectId
  salesReports SpotIncentiveSalesReport[]

  @@map("Plan")
}

model SpotIncentiveSalesReport {
  id            String     @id @default(auto()) @map("_id") @db.ObjectId
  secId         String     @db.ObjectId
  secUser       SEC     @relation(fields: [secId], references: [id])
  storeId       String
  store         Store      @relation(fields: [storeId], references: [id])
  samsungSKUId  String     @db.ObjectId
  samsungSKU    SamsungSKU @relation(fields: [samsungSKUId], references: [id])
  planId        String     @db.ObjectId
  plan          Plan       @relation(fields: [planId], references: [id])
  imei          String
  planPrice     Int
  incentiveEarned Int      // Calculated incentive amount
  voucherCode   String?    // Optional voucher code for incentive redemption
  isPaid        Boolean    @default(false)
  paidAt        DateTime?
  submittedAt   DateTime   @default(now())
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([secId])
  @@index([storeId])
  @@index([submittedAt])
  @@unique([imei])
}

model User {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  username String @unique
  password String
  role     Role

  // admin-based approval status for this user (PENDING by default, APPROVED/BLOCKED set by admin)
  validation Validation @default(PENDING)

  // all signup form fields except username, password and role (store mapping + user mapping)
  metadata Json?

  abmProfile          ABM?          @relation("UserABM")
  aseProfile          ASE?          @relation("UserASE")
  zbmProfile          ZBM?          @relation("UserZBM")
  zseProfile          ZSE?          @relation("UserZSE")
  samsungAdminProfile SamsungAdmin? @relation("UserSamsungAdmin")
  zopperAdminProfile  ZopperAdmin?  @relation("UserZopperAdmin")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ABM {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId

  fullName String
  phone    String

  storeIds String[]
  zbmId    String @db.ObjectId

  user User @relation("UserABM", fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ASE {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId

  fullName String
  phone    String

  storeIds String[]
  zseId    String @db.ObjectId

  user User @relation("UserASE", fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ZBM {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId

  fullName String
  phone    String

  region String?

  user User @relation("UserZBM", fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ZSE {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId

  fullName String
  phone    String

  region String?

  user User @relation("UserZSE", fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SEC {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId

  fullName    String?
  phone       String   @unique
  lastLoginAt DateTime?

  salesReports SpotIncentiveSalesReport[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Otp {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  phone     String
  code      String
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([phone])
}

model SamsungAdmin {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId

  fullName String
  phone    String

  user User @relation("UserSamsungAdmin", fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ZopperAdmin {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId

  fullName String
  phone    String

  user User @relation("UserZopperAdmin", fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClaimProcedurePDF {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String?
  fileName    String
  fileSize    Int
  fileData    String   // Base64 encoded PDF data
  category    String   @default("GENERAL")
  isActive    Boolean  @default(true)
  uploadedAt  DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([isActive])
}
